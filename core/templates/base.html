{% load static %}
{% load custom_filters %}
<html>
<<<<<<< Updated upstream
  <head>
    <title>Task Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300..800&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link href="{% static 'css/base.css' %}" rel="stylesheet" />
  </head>
  <body>
    <div>
      <header>
        <div class="nav-left">
          <h1><a href="{% url 'home' %}">Task Manager</a></h1>
        </div>
        <div class="nav-right">
          {% if user.is_authenticated %}
          <p class="username">{{ user.username }}</p>
          <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" style="color: #dddddd">Logout</button>
          </form>
          {% else %}
          <button><a href="{% url 'login' %}">Log In</a></button>
          {% endif %}
=======

<head>
  <title>Task Manager</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@100..900&display=swap" rel="stylesheet" />
  <link href="{% static 'css/base.css' %}" rel="stylesheet" />
  <link href="{% static 'css/criar_tarefa.css' %}" rel="stylesheet" />
  <link href="{% static 'css/criar_projeto.css' %}" rel="stylesheet" />
  <link href="{% static 'css/login.css' %}" rel="stylesheet" />
  <link href="{% static 'css/signup.css' %}" rel="stylesheet" />
</head>

<body>
  <!-- Cabeçalho -->
  <header>
    <div class="nav">
      <div class="nav-left">
        <h1><a href="{% url 'home' %}">Task Manager</a></h1>
      </div>
      <div class="nav-right">
        {% if user.is_authenticated %}
        <p class="user_logged">{{ user.username }}</p>
        <form action="{% url 'logout' %}" method="post">
          {% csrf_token %}
          <button type="submit">Logout</button>
        </form>
        {% else %}
        <button class="loggin_button">
          <a href="{% url 'login' %}">Log In</a>
        </button>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Conteúdo principal -->
  <div class="content">
    {% block content %}
    {% if user.is_authenticated %}
    <h1 class="title">Projetos</h1>
    <div class="actions">
      <button><a href="{% url 'criar_projeto' %}">Criar Projeto</a></button>
    </div>

    <!-- Container de Projetos -->
    <div class="projects-container" style="display: flex; flex-wrap: wrap; gap: 20px;">
      {% for projeto in projetos %}
      <div class="project-column" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: #fff; width: 30%; box-shadow: rgba(0, 0, 0, 0.1) 1.95px 1.95px 2.6px;">
        <!-- Cabeçalho do Projeto -->
        <div class="project-header">
          <h2>{{ projeto.nome }}</h2>
          <p>{{ projeto.descricao }}</p>
          <!-- Progress Bar -->
            {% with total_tasks=projeto.tarefas.all|length %}
              {% with completed_tasks=projeto.tarefas.all|filter_status:"concluída"|length %}
                {% if total_tasks > 0 %}
                  {% with progress=completed_tasks|multiply:100|divide:total_tasks %}
                    <div class="progress-container">
                      <div class="progress-bar">
                        <div class="progress" style="width: {{ progress }}%"></div>
                      </div>
                      <span class="progress-text">{{ progress|floatformat:0 }}% Concluído</span>
                    </div>
                  {% endwith %}
                {% else %}
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div class="progress" style="width: 0%"></div>
                    </div>
                    <span class="progress-text">0% Concluído</span>
                  </div>
                {% endif %}
              {% endwith %}
            {% endwith %}

            <button class="toggle-tasks" data-project-id="{{ projeto.id }}">Mostrar Tarefas</button>
          <button><a href="#">Editar Projeto</a></button>
>>>>>>> Stashed changes
        </div>
      </header>
      {% block content %} {% if user.is_authenticated %}
      <h1>Projetos</h1>
      <button>Criar Projeto</button>
      <ul>
        {% for projeto in projetos %}
        <div class="projeto">
          <li>
            {{ projeto.nome }} - {{ projeto.descricao }}
            <button>Editar Projeto</button>

<<<<<<< Updated upstream
            {% with total_tarefas=projeto.tarefa.count completed_tarefas=projeto.tarefa.filter(status='Concluída').count %}
               {% if total_tarefas > 0 %}
                  {% with progress=(completed_tarefas|floatformat:2|floatformat:"0")|divisibleby:total_tarefas|floatformat:2 %}
            <div class="progress-bar">
              <div class="progress" style="width: {{ progress }}%;"></div>
            </div>
            <p>{{ progress }}% concluído</p>
                  {% endwith %} 
               {% else %}
            <div class="progress-bar">
              <div class="progress" style="width: 0%"></div>
            </div>
            <p>0% concluído</p>
               {% endif %} 
            {% endwith %}

            <ul>
              {% for tarefa in tarefas %} {% if tarefa.projeto == projeto %}
              <li class="tarefa">
                <p>{{ tarefa.nome }}</p>
                <p>{{ tarefa.descricao }}</p>
                <p>Responsável: {{ tarefa.responsavel }}</p>
                <p>Prazo: {{ tarefa.prazo }}</p>
                <p>Status: {{ tarefa.status }}</p>
                {% if tarefa.status == 'Concluída' %}
                <p>Data de Conclusão: {{ tarefa.data_conclusao }}</p>
                {% endif %}
                <button>Editar Tarefa</button>
                <div class="comentarios">
                  {% with comentarios|length as num_comentarios %} {% if
                  num_comentarios > 0 %}
                  <p>Comentários</p>
                  {% for comentario in comentarios %} {% if comentario.tarefa ==
                  tarefa %}
                  <p>{{ comentario.conteudo }}</p>
                  <p>Data: {{ comentario.criado_em }}</p>
                  <p>Autor: {{ comentario.autor }}</p>
                  {% endif %} {% endfor %} {% endif %} {% endwith %}
                  <form method="POST">
                    {% csrf_token %}
                    <input
                      type="hidden"
                      name="tarefa_id"
                      value="{{ tarefa.id }}"
                    />
                    <input type="text" name="texto" />
                    <button class="comentar-btn" type="submit">Comentar</button>
                  </form>
                </div>
                <div class="anexos">
                  {% with anexos|length as num_anexos %} {% if num_anexos > 0 %}
                  <p>Anexos</p>
                  <ul>
                    {% for anexo in anexos %} {% if anexo.tarefa == tarefa %}
                    <li>
                      <a href="{{ anexo.arquivo.url }}">{{ anexo.nome }}</a>
                      <p>Data: {{ anexo.criado_em }}</p>
                      <p>Autor: {{ anexo.autor }}</p>
                    </li>
                    {% endif %} {% endfor %}
                  </ul>
                  {% endif %} {% endwith %}
                  <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input
                      type="hidden"
                      name="tarefa_id"
                      value="{{ tarefa.id }}"
                    />
                    <input type="file" name="arquivo" />
                    <button class="anexar-btn" type="submit">Anexar</button>
                  </form>
                </div>
              </li>
              {% endif %} {% endfor %}
              <li>
                <button>Criar Tarefa</button>
              </li>
            </ul>
          </li>
        </div>
        {% empty %}
        <li>Não há projetos disponíveis.</li>
        {% endfor %}
      </ul>
      {% endif %} {% endblock content %}
    </div>
  </body>
=======
        <!-- Tarefas do Projeto -->
        <ul class="tasks-list">
          {% for tarefa in tarefas %}
          {% if tarefa.projeto == projeto %}
          <li class="task-item" style="border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 8px; background-color: #f9f9f9;">
            <!-- Detalhes da Tarefa -->
            <h3>{{ tarefa.nome }}</h3>
            <p>{{ tarefa.descricao }}</p>
            <p><strong>Responsável:</strong> {{ tarefa.responsavel }}</p>
            <p><strong>Prazo:</strong> {{ tarefa.prazo }}</p>
            <p><strong>Status:</strong> {{ tarefa.status }}</p>
            {% if tarefa.status == 'Concluída' %}
            <p><strong>Data de Conclusão:</strong> {{ tarefa.data_conclusao }}</p>
            {% endif %}
            <button><a href="#">Editar Tarefa</a></button>

            <!-- Seção de Anexos -->
            <div class="attachments-section">
              {% with anexos|length as num_anexos %}
              {% if num_anexos > 0 %}
              <h4>Anexos:</h4>
              <ul>
                {% for anexo in anexos %}
                {% if anexo.tarefa == tarefa %}
                <li>
                  <a href="{{ anexo.arquivo.url }}">{{ anexo.nome }}</a>
                  <p><strong>Data:</strong> {{ anexo.criado_em }}</p>
                  <p><strong>Autor:</strong> {{ anexo.autor }}</p>
                </li>
                {% endif %}
                {% endfor %}
              </ul>
              {% endif %}
              {% endwith %}
              <!-- Botão para anexar arquivo -->
              <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="tarefa_id" value="{{ tarefa.id }}" />
                <input type="file" name="arquivo" />
                <button type="submit">Anexar</button>
              </form>
            </div>
          </li>
          {% endif %}
          {% endfor %}

          <!-- Botão para criar nova tarefa -->
          <li>
            <button><a href="{% url 'criar_tarefa' %}">Criar Tarefa</a></button>
          </li>
        </ul>
      </div>
      {% empty %}
      <p>Não há projetos disponíveis.</p>
      {% endfor %}
    </div>
    {% endif %}
    {% endblock content %}
  </div>
</body>

>>>>>>> Stashed changes
</html>
